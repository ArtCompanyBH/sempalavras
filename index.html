<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sem Palavras I Jogo da GD</title>
    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Code",
  "name": "Implementação Otimizada do Jogo Wordle em JavaScript",
  "description": "Código completo do jogo de adivinhação de palavras com modos temático e aleatório, otimizado para performance",
  "keywords": [
    "wordle javascript",
    "jogo de palavras completo",
    "implementação wordle",
    "jogo de adivinhar palavras",
    "javascript otimizado para jogos",
    "código wordle com dois modos",
    "wordle diário e aleatório",
    "jogo wordle gestão documental",
    "wordle com tamanhos variáveis",
    "javascript performance optimization"
  ],
  "codeRepository": "https://github.com/exemplo/wordle-gestao-documental",
  "programmingLanguage": "JavaScript",
  "runtimePlatform": "Web Browser",
  "featureList": [
    "Modo diário com palavras temáticas",
    "Modo aleatório com palavras do dicionário",
    "Três tamanhos de palavras (4,5,6 letras)",
    "Sistema de estatísticas completo",
    "Armazenamento local do progresso",
    "Teclado virtual interativo",
    "Animações otimizadas",
    "Design responsivo"
  ],
  "performanceOptimization": {
    "domCaching": true,
    "batchProcessing": true,
    "debouncedSaving": true,
    "cssAnimations": true,
    "memoryManagement": true
  },
  "author": {
    "@type": "Person",
    "name": "Seu Nome"
  },
  "datePublished": "2023-11-15"
}
</script>
    <style>
        /* Reset e estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow-x: hidden;
        }

        /* Background com overlay fosco */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://yata-apix-2ab89473-8390-4d98-815c-3c42dfd8b529.s3-object.locaweb.com.br/9d6c1781c28a4566b0606d97e5b08b00.png') no-repeat center center;
            background-size: cover;
            z-index: -2;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.65);
            z-index: -1;
        }

        /* Container principal */
        .container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
            margin: 0 auto;
        }

        /* Logo */
        .logo {
            width: 300px;
            height: 80px;
            margin: 0 auto 10px;
            background-color: #b30202;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Cabeçalho */
        h1 {
            color: #2c3e50;
            margin: 0 0 15px;
            font-size: 2.2rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        h3 {
            color: #2c3e50;
            margin: 0 0 15px;
            font-size: 1rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        /* Painel de informações */
        .info-panel {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 7px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(5px);
        }

        .settings {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .setting-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        select {
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background-color: white;
        }

        .daily-info {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #555;
        }

        /* Tabuleiro do jogo */
        .board {
            display: grid;
            grid-template-rows: repeat(var(--rows), minmax(50px, 1fr));
            grid-gap: 5px;
            margin: 20px auto;
            width: 100%;
            max-width: calc(var(--cols) * (50px + 5px));
        }

        .row {
            display: grid;
            grid-template-columns: repeat(var(--cols), 1fr);
            grid-gap: 5px;
        }

        .cell {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.9);
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1.5rem;
            font-weight: bold;
            text-transform: uppercase;
            aspect-ratio: 1/1;
            transition: all 0.3s ease;
            backdrop-filter: blur(2px);
            position: relative;
            transform-style: preserve-3d;
        }

        .cell.filled {
            border-color: #878a8c;
            animation: pop 0.1s ease;
        }

        .cell.flip {
            animation: flip 0.6s ease forwards;
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes flip {
            0% {
                transform: rotateX(0);
                background-color: rgba(255, 255, 255, 0.9);
                border-color: #ddd;
            }
            45% {
                transform: rotateX(90deg);
                background-color: rgba(255, 255, 255, 0.9);
                border-color: #ddd;
            }
            55% {
                transform: rotateX(90deg);
            }
            100% {
                transform: rotateX(0);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.5s ease;
        }

        .correct {
            background-color: #6aaa64;
            color: white;
            border-color: #6aaa64;
        }

        .present {
            background-color: #c9b458;
            color: white;
            border-color: #c9b458;
        }

        .absent {
            background-color: #787c7e;
            color: white;
            border-color: #787c7e;
        }

        /* Teclado virtual */
        .keyboard {
            margin-top: 20px;
            width: 100%;
            max-width: 500px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(5px);
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            margin-bottom: 8px;
        }

        .key {
            min-width: 8%;
            height: 50px;
            margin: 0 3px;
            border: none;
            border-radius: 4px;
            background-color: #d3d6da;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 5px;
            text-transform: uppercase;
            transition: all 0.1s ease;
        }

        .key.wide {
            min-width: 12%;
            font-size: 0.8rem;
        }

        .key:active {
            transform: scale(0.95);
        }

        /* Mensagens */
        .message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
            width: 100%;
            max-width: 500px;
        }

        .message.show {
            opacity: 1;
        }

        .message.success {
            background-color: rgba(106, 170, 100, 0.9);
            color: white;
        }

        .message.error {
            background-color: rgba(244, 67, 54, 0.9);
            color: white;
        }

        /* Contador para próxima palavra */
        .next-word-countdown {
            margin-top: 20px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            font-size: 0.9rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: none;
        }

        /* Estatísticas */
        .stats-panel {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin: 20px auto;
            max-width: 500px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .stats-panel.show {
            display: block;
        }

        .stats-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #555;
        }

        .stats-history {
            margin-top: 15px;
        }

        .history-title {
            font-size: 1rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .history-bars {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            height: 100px;
            margin-top: 10px;
        }

        .history-bar {
            width: 30px;
            background-color: #6aaa64;
            border-radius: 3px;
            position: relative;
            transition: height 0.5s ease;
        }

        .history-bar-label {
            position: absolute;
            bottom: -20px;
            width: 100%;
            text-align: center;
            font-size: 0.7rem;
        }

        .stats-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .stats-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            background-color: #2c3e50;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* Responsividade */
        @media (max-width: 600px) {
            .logo {
                width: 150px;
                height: 80px;
                font-size: 1.2rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .settings {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .cell {
                font-size: 1.2rem;
            }
            
            .key {
                height: 45px;
                font-size: 0.9rem;
                min-width: 7%;
            }
            
            .key.wide {
                min-width: 10%;
                font-size: 0.7rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 400px) {
            .container {
                padding: 10px;
            }
            
            .cell {
                font-size: 1rem;
            }
            
            .key {
                height: 40px;
                font-size: 0.8rem;
                margin: 0 2px;
            }
        }
        
        .admin-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 8px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 0.8rem;
            cursor: pointer;
            z-index: 1000;
            opacity: 0.1;
            transition: opacity 0.3s;
        }

        .admin-btn:hover {
            opacity: 1;
        }
        
        /* Adicione estas regras se necessário */
        .row {
            display: grid;
            grid-template-columns: repeat(var(--cols), 1fr);
            gap: 5px;
            margin-bottom: 5px;
        }

        .cell {
            min-width: 50px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Espaço para logo -->
        <div class="logo">Gestão Documental <br>TJMMG</br></div>
        
        <h1>SEM PALAVRAS</h1>
        <h3>O JOGO DIÁRIO DA GD :)</h3>
        
        <div class="info-panel">
            <div class="settings">
                <div class="setting-group">
                    <label for="wordLength">Tamanho:</label>
                    <select id="wordLength">
                        <option value="4">4 letras</option>
                        <option value="5" selected>5 letras</option>
                        <option value="6">6 letras</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="gameMode">Modo:</label>
                    <select id="gameMode">
                        <option value="daily">Temático GD</option>
                        <option value="random">Aleatório</option>
                    </select>
                </div>
                <button id="statsBtn" class="stats-btn">Estatísticas</button>
            </div>
            <div class="daily-info" id="dailyInfo"></div>
        </div>
        
        <div class="board" id="board"></div>
        
        <div class="message" id="message"></div>
        
        <div class="next-word-countdown" id="countdown"></div>

        <!-- Painel de estatísticas -->
        <div class="stats-panel" id="statsPanel">
            <div class="stats-title">Estatísticas</div>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="gamesPlayed">0</div>
                    <div class="stat-label">Jogos</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="winPercentage">0%</div>
                    <div class="stat-label">Vitórias</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="currentStreak">0</div>
                    <div class="stat-label">Sequência</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="maxStreak">0</div>
                    <div class="stat-label">Máximo</div>
                </div>
            </div>
            <div class="stats-history">
                <div class="history-title">Distribuição de Tentativas</div>
                <div class="history-bars" id="historyBars"></div>
            </div>
            <div class="stats-buttons">
                <button id="closeStatsBtn" class="stats-btn">Fechar</button>
                <button id="shareStatsBtn" class="stats-btn">Compartilhar</button>
            </div>
        </div>
        
        <div class="keyboard">
            <div class="keyboard-row">
                <div class="key" data-key="Q">Q</div>
                <div class="key" data-key="W">W</div>
                <div class="key" data-key="E">E</div>
                <div class="key" data-key="R">R</div>
                <div class="key" data-key="T">T</div>
                <div class="key" data-key="Y">Y</div>
                <div class="key" data-key="U">U</div>
                <div class="key" data-key="I">I</div>
                <div class="key" data-key="O">O</div>
                <div class="key" data-key="P">P</div>
            </div>
            <div class="keyboard-row">
                <div class="key" data-key="A">A</div>
                <div class="key" data-key="S">S</div>
                <div class="key" data-key="D">D</div>
                <div class="key" data-key="F">F</div>
                <div class="key" data-key="G">G</div>
                <div class="key" data-key="H">H</div>
                <div class="key" data-key="J">J</div>
                <div class="key" data-key="K">K</div>
                <div class="key" data-key="L">L</div>
            </div>
            <div class="keyboard-row">
                <div class="key wide" data-key="Enter">Enter</div>
                <div class="key" data-key="Z">Z</div>
                <div class="key" data-key="X">X</div>
                <div class="key" data-key="C">C</div>
                <div class="key" data-key="V">V</div>
                <div class="key" data-key="B">B</div>
                <div class="key" data-key="N">N</div>
                <div class="key" data-key="M">M</div>
                <div class="key wide" data-key="Backspace">⌫</div>
            </div>
        </div>
        <button onclick="forceReset()" class="admin-btn">Reset Admin</button>
    </div>

    <script>
// Configurações do jogo
const config = {
    wordLength: 5,
    maxAttempts: 6,
    currentAttempt: 0,
    currentGuess: [],
    targetWord: '',
    gameOver: false,
    keyboardState: {},
    gameMode: 'daily' // 'daily' ou 'random'
};

// Listas de palavras-alvo por tamanho (para garantir consistência diária)
const targetWordLists = {
    4: ['ACAO', 'ATOS', 'AUTO', 'BENS', 'JUIZ', 'VARA', 'SELO', 'RITO', 'FATO', 'TIPO', 'NOME', 'DOCS', 'DANO', 'FORO', 'JURO', 'LEIS', 'NOTA', 'PENA', 'REUS', 'VETO', 'VOTO', 'ATAS', 'DADO', 'DATA', 'FITA', 'GUIA', 'ITEM', 'FIXO', 'FASE', 'REUS', 'TURNO'],
    5: ['ACORDO', 'AUTUA', 'ANEXO', 'AUTOS', 'CAIXA', 'CERTA', 'COPIA', 'CRIME', 'EDITA', 'EXAME', 'FICHA', 'FOLHA', 'FUNDO', 'JULGA', 'JURIS', 'LAUDO', 'LEGAL', 'LIVRO', 'LIVRO', 'MEDIA', 'ORDEM', 'NORMA', 'PEDIR', 'SELAR', 'PAPEL', 'PASTA', 'PRAZO', 'PROVA', 'SEARA', 'SECAO', 'TERMO', 'TESTE', 'TOMBO', 'VOTAR', 'VISTA'],
    6: ['AUTUAR', 'CITADO', 'ACORDAO', 'ALEGAR', 'ANEXAR', 'APENSOS', 'ADIADA', 'ARGUIR', 'HABEAS', 'ADITAR', 'LAUDAR', 'LAVRAR', 'RECEBE', 'REUSOS', 'DECIDA', 'VISTAS', 'MINUTA', 'INTIMA', 'JULGAR', 'APELAR', 'DENEGA', 'EMENDA', 'EXCETO', 'FORMAR', 'OITIVA', 'PEDIDO', 'REVISA', 'SUSTAR', 'TUTELA', 'VOTADO', 'VENCER', 'TOGADO', 'FOLHAS', 'NUMERO', 'DIGITO', 'VERSOS', 'CAIXAS', 'CODIGO', 'DOSSIE', 'FICHAS', 'GUARDA', 'LACRAR', 'LIVROS', 'ORIGEM', 'PASTAS', 'SINAIS', 'CIENTE', 'DIARIO', 'EDITAL', 'FISCAL', 'LICITA', 'OFICIO', 'OFICIA', 'RELATO', 'AVALIA', 'FILTRA', 'GESTAO', 'AVOCAR', 'INDEXA', 'MANUAL', 'NORMAS', 'PLANOS', 'REGIME', 'RENOVA', 'TAREFA', 'TERMOS', 'UNIDOS', 'VISTOS']
};

// Dicionário de palavras válidas
let dictionary = new Set();
let allWords = []; // Todas as palavras do arquivo palavras.txt

// Elementos DOM
const board = document.getElementById('board');
const message = document.getElementById('message');
const dailyInfo = document.getElementById('dailyInfo');
const wordLengthSelect = document.getElementById('wordLength');
const gameModeSelect = document.getElementById('gameMode');
const keys = document.querySelectorAll('.key');
const countdown = document.getElementById('countdown');
const statsBtn = document.getElementById('statsBtn');
const statsPanel = document.getElementById('statsPanel');
const closeStatsBtn = document.getElementById('closeStatsBtn');
const shareStatsBtn = document.getElementById('shareStatsBtn');
const gamesPlayedEl = document.getElementById('gamesPlayed');
const winPercentageEl = document.getElementById('winPercentage');
const currentStreakEl = document.getElementById('currentStreak');
const maxStreakEl = document.getElementById('maxStreak');
const historyBars = document.getElementById('historyBars');

// Variáveis de controle
const ADMIN_PASSWORD = "Gushi150#";
let stats = {
    gamesPlayed: 0,
    gamesWon: 0,
    currentStreak: 0,
    maxStreak: 0,
    guessDistribution: [0, 0, 0, 0, 0, 0],
    lastPlayed: null
};

async function loadDictionary() {
    try {
        const response = await fetch('palavras.txt');
        if (!response.ok) throw new Error('Falha ao carregar o dicionário');
        
        const reader = response.body.getReader();
        let chunks = '';
        
        while(true) {
            const {done, value} = await reader.read();
            if (done) break;
            chunks += new TextDecoder().decode(value);
        }

        // Processa em chunks para não bloquear a UI
        const words = chunks.split('\n')
            .map(word => word.trim().toUpperCase())
            .filter(word => word.length >= 4 && word.length <= 6);
        
        allWords = words;
        const initialSize = dictionary.size;
        
        // Adiciona em lotes para não travar a UI
        const batchSize = 1000;
        for (let i = 0; i < words.length; i += batchSize) {
            const batch = words.slice(i, i + batchSize);
            batch.forEach(word => dictionary.add(word));
        }
        
        console.log(`Dicionário carregado com ${dictionary.size} palavras (${dictionary.size - initialSize} novas)`);
        
        // Adiciona as palavras-alvo como fallback
        Object.values(targetWordLists).flat().forEach(word => {
            const upperWord = word.toUpperCase();
            dictionary.add(upperWord);
            if (!allWords.includes(upperWord)) allWords.push(upperWord);
        });
        
    } catch (error) {
        console.error('Erro ao carregar dicionário:', error);
        allWords = Object.values(targetWordLists).flat().map(w => w.toUpperCase());
        allWords.forEach(word => dictionary.add(word));
        console.log(`Usando fallback com ${dictionary.size} palavras`);
    }
}
function isValidWord(word) {
    return dictionary.has(word.toUpperCase());
}

function getDailyWord() {
    const today = new Date();
    const dateStr = `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;
    
    let hash = 0;
    for (let i = 0; i < dateStr.length; i++) {
        hash = (hash << 5) - hash + dateStr.charCodeAt(i);
        hash |= 0;
    }
    
    const wordList = targetWordLists[config.wordLength];
    const index = Math.abs(hash) % wordList.length;
    return wordList[index].toUpperCase();
}

function getRandomDailyWord() {
    const today = new Date();
    const dateStr = `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;
    
    let hash = 0;
    for (let i = 0; i < dateStr.length; i++) {
        hash = (hash << 5) - hash + dateStr.charCodeAt(i);
        hash |= 0;
    }
    
    const wordsOfLength = allWords.filter(word => word.length === config.wordLength);
    if (wordsOfLength.length === 0) {
        const wordList = targetWordLists[config.wordLength] || [];
        const index = Math.abs(hash) % wordList.length;
        return wordList[index].toUpperCase();
    }
    
    const index = Math.abs(hash) % wordsOfLength.length;
    return wordsOfLength[index].toUpperCase();
}

function initStats() {
    const savedStats = localStorage.getItem('wordleStats');
    if (savedStats) {
        try {
            stats = JSON.parse(savedStats);
            stats.gamesPlayed = stats.gamesPlayed || 0;
            stats.gamesWon = stats.gamesWon || 0;
            stats.currentStreak = stats.currentStreak || 0;
            stats.maxStreak = stats.maxStreak || 0;
            stats.guessDistribution = stats.guessDistribution || [0, 0, 0, 0, 0, 0];
            stats.lastPlayed = stats.lastPlayed || null;
        } catch (e) {
            console.error('Erro ao carregar estatísticas:', e);
            resetStats();
        }
    }
}

function resetStats() {
    stats = {
        gamesPlayed: 0,
        gamesWon: 0,
        currentStreak: 0,
        maxStreak: 0,
        guessDistribution: [0, 0, 0, 0, 0, 0],
        lastPlayed: null
    };
    localStorage.setItem('wordleStats', JSON.stringify(stats));
}

function updateStats(win, attempts) {
    const today = new Date().toISOString().split('T')[0];
    if (stats.lastPlayed === today) return;
    
    stats.gamesPlayed++;
    if (win) {
        stats.gamesWon++;
        stats.currentStreak++;
        if (stats.currentStreak > stats.maxStreak) stats.maxStreak = stats.currentStreak;
        if (attempts >= 1 && attempts <= 6) stats.guessDistribution[attempts - 1]++;
    } else {
        stats.currentStreak = 0;
    }
    
    stats.lastPlayed = today;
    localStorage.setItem('wordleStats', JSON.stringify(stats));
    updateStatsDisplay();
}

function updateStatsDisplay() {
    gamesPlayedEl.textContent = stats.gamesPlayed;
    winPercentageEl.textContent = stats.gamesPlayed > 0 
        ? Math.round((stats.gamesWon / stats.gamesPlayed) * 100) + '%' 
        : '0%';
    currentStreakEl.textContent = stats.currentStreak;
    maxStreakEl.textContent = stats.maxStreak;
    
    historyBars.innerHTML = '';
    const maxValue = Math.max(...stats.guessDistribution, 1);
    
    for (let i = 0; i < 6; i++) {
        const bar = document.createElement('div');
        bar.className = 'history-bar';
        bar.style.height = `${stats.guessDistribution[i] / maxValue * 80}px`;
        
        const label = document.createElement('div');
        label.className = 'history-bar-label';
        label.textContent = (i + 1).toString();
        
        const value = document.createElement('div');
        value.style.position = 'absolute';
        value.style.top = '-20px';
        value.style.width = '100%';
        value.style.textAlign = 'center';
        value.style.fontSize = '0.7rem';
        value.textContent = stats.guessDistribution[i];
        
        bar.appendChild(value);
        bar.appendChild(label);
        historyBars.appendChild(bar);
    }
}

function isNewDay() {
    const today = new Date().toDateString();
    const storedDay = localStorage.getItem('wordleDay');
    return storedDay !== today;
}

async function initGame() {
    await loadDictionary();
    
    const today = new Date().toDateString();
    if (isNewDay()) {
        localStorage.setItem('wordleDay', today);
        localStorage.removeItem('wordleProgress');
    }
    
    const progress = JSON.parse(localStorage.getItem('wordleProgress')) || {};
    
    if (progress[config.wordLength]?.[config.gameMode]?.gameOver) {
        config.gameOver = true;
        board.style.display = 'none';
        showMessage(`Você já completou o jogo de ${config.wordLength} letras no modo ${config.gameMode === 'daily' ? 'temático' : 'aleatório'} hoje!`, 'error');
        updateCountdown();
        return;
    }
    
    config.targetWord = config.gameMode === 'daily' ? getDailyWord() : getRandomDailyWord();
    config.currentAttempt = 0;
    config.currentGuess = [];
    config.gameOver = false;
    config.keyboardState = {};
    
    board.style.display = 'grid';
    document.documentElement.style.setProperty('--rows', config.maxAttempts);
    document.documentElement.style.setProperty('--cols', config.wordLength);
    
    dailyInfo.textContent = config.gameMode === 'daily' 
        ? `Palavra do dia (${config.wordLength} letras) - ${formatDate(new Date())}`
        : `Modo Aleatório (${config.wordLength} letras) - ${formatDate(new Date())}`;
    
    board.innerHTML = '';
    for (let i = 0; i < config.maxAttempts; i++) {
        const row = document.createElement('div');
        row.className = 'row';
        for (let j = 0; j < config.wordLength; j++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.dataset.row = i;
            cell.dataset.col = j;
            row.appendChild(cell);
        }
        board.appendChild(row);
    }
    
    if (progress[config.wordLength]?.[config.gameMode]) {
        const saved = progress[config.wordLength][config.gameMode];
        config.currentAttempt = saved.attempts?.length || 0;
        config.keyboardState = saved.keyboardState || {};
        config.gameOver = saved.gameOver || false;
        
        if (saved.attempts) {
            for (let i = 0; i < saved.attempts.length; i++) {
                const row = board.children[i];
                const word = saved.attempts[i];
                for (let j = 0; j < config.wordLength; j++) {
                    const cell = row.children[j];
                    cell.textContent = word[j] || '';
                    cell.classList.add('filled');
                }
                simulateWordCheck(i, word);
            }
        }
        
        if (config.gameOver) {
            board.style.display = 'none';
            showMessage(`Você já completou o jogo de ${config.wordLength} letras no modo ${config.gameMode === 'daily' ? 'temático' : 'aleatório'} hoje!`, 'error');
            updateCountdown();
        }
    }
    
    updateBoard();
    updateKeyboard();
}

function simulateWordCheck(rowIndex, word) {
    const row = board.children[rowIndex];
    const targetLetters = config.targetWord.split('');
    const guessLetters = word.split('');
    
    for (let i = 0; i < config.wordLength; i++) {
        if (guessLetters[i] === targetLetters[i]) {
            row.children[i].classList.add('correct');
            targetLetters[i] = null;
            guessLetters[i] = null;
            config.keyboardState[word[i]] = 'correct';
        }
    }
    
    for (let i = 0; i < config.wordLength; i++) {
        if (guessLetters[i] === null) continue;
        
        const index = targetLetters.indexOf(guessLetters[i]);
        if (index !== -1) {
            row.children[i].classList.add('present');
            targetLetters[index] = null;
            if (config.keyboardState[word[i]] !== 'correct') {
                config.keyboardState[word[i]] = 'present';
            }
        } else {
            row.children[i].classList.add('absent');
            if (!config.keyboardState[word[i]]) {
                config.keyboardState[word[i]] = 'absent';
            }
        }
    }
}

function formatDate(date) {
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    return date.toLocaleDateString('pt-BR', options);
}

function updateCountdown() {
    const now = new Date();
    const midnight = new Date();
    midnight.setHours(24, 0, 0, 0);
    
    const diff = midnight - now;
    const hours = Math.floor(diff / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    
    countdown.textContent = `Próxima palavra em: ${hours}h ${minutes}m`;
    countdown.style.display = 'block';
}

function disableKeyboard() {
    keys.forEach(key => {
        key.style.pointerEvents = 'none';
        key.style.opacity = '0.6';
    });
}

function enableKeyboard() {
    keys.forEach(key => {
        key.style.pointerEvents = 'auto';
        key.style.opacity = '1';
    });
}

function updateKeyboard() {
    keys.forEach(key => {
        const keyChar = key.dataset.key;
        if (config.keyboardState[keyChar]) {
            key.className = `key ${config.keyboardState[keyChar]}`;
        } else {
            key.className = 'key';
        }
    });
}

function addLetter(letter) {
    if (config.currentGuess.length < config.wordLength && !config.gameOver) {
        config.currentGuess.push(letter);
        updateBoard();
    }
}

function removeLetter() {
    if (config.currentGuess.length > 0 && !config.gameOver) {
        config.currentGuess.pop();
        updateBoard();
    }
}

function updateBoard() {
    const row = board.children[config.currentAttempt];
    for (let i = 0; i < config.wordLength; i++) {
        const cell = row.children[i];
        if (i < config.currentGuess.length) {
            cell.textContent = config.currentGuess[i];
            cell.classList.add('filled');
        } else {
            cell.textContent = '';
            cell.classList.remove('filled');
        }
    }
}

function checkGuess(isUserAction = true) {
    if (config.currentGuess.length !== config.wordLength || config.gameOver) {
        if (isUserAction) {
            showMessage('Palavra incompleta!', 'error');
            setTimeout(() => message.className = 'message', 1000);
        }
        return false;
    }
    
    const guess = config.currentGuess.join('').toUpperCase();
    if (isUserAction && !isValidWord(guess)) {
        showMessage('Palavra não reconhecida!', 'error');
        const row = board.children[config.currentAttempt];
        row.classList.add('shake');
        setTimeout(() => {
            row.classList.remove('shake');
            message.className = 'message';
        }, 1000);
        return false;
    }
    
    const row = board.children[config.currentAttempt];
    const targetLetters = config.targetWord.split('');
    const guessLetters = [...config.currentGuess];
    
    for (let i = 0; i < config.wordLength; i++) {
        const cell = row.children[i];
        setTimeout(() => {
            cell.classList.add('flip');
            setTimeout(() => cell.classList.remove('flip'), 600);
        }, i * 200);
    }
    
    for (let i = 0; i < config.wordLength; i++) {
        if (guessLetters[i] === targetLetters[i]) {
            setTimeout(() => row.children[i].classList.add('correct'), i * 200 + 300);
            targetLetters[i] = null;
            guessLetters[i] = null;
            config.keyboardState[guess[i]] = 'correct';
        }
    }
    
    for (let i = 0; i < config.wordLength; i++) {
        if (guessLetters[i] === null) continue;
        
        const index = targetLetters.indexOf(guessLetters[i]);
        if (index !== -1) {
            setTimeout(() => row.children[i].classList.add('present'), i * 200 + 300);
            targetLetters[index] = null;
            if (config.keyboardState[guess[i]] !== 'correct') {
                config.keyboardState[guess[i]] = 'present';
            }
        } else {
            setTimeout(() => row.children[i].classList.add('absent'), i * 200 + 300);
            if (!config.keyboardState[guess[i]]) {
                config.keyboardState[guess[i]] = 'absent';
            }
        }
    }
    
    setTimeout(() => updateKeyboard(), config.wordLength * 200 + 300);
    
    if (guess === config.targetWord) {
        setTimeout(() => {
            showMessage('Parabéns! Você acertou!', 'success');
            config.gameOver = true;
            if (isUserAction) updateStats(true, config.currentAttempt + 1);
            board.style.display = 'none';
            setTimeout(() => {
                showMessage(`Você já completou o jogo de ${config.wordLength} letras no modo ${config.gameMode === 'daily' ? 'temático' : 'aleatório'} hoje!`, 'error');
            }, 1500);
            saveProgress();
            updateCountdown();
            setInterval(updateCountdown, 60000);
        }, config.wordLength * 200 + 500);
        return true;
    }
    
    config.currentAttempt++;
    config.currentGuess = [];
    
    if (config.currentAttempt >= config.maxAttempts) {
        setTimeout(() => {
            showMessage(`Fim de jogo! A palavra era: ${config.targetWord}`, 'error');
            config.gameOver = true;
            if (isUserAction) updateStats(false);
            board.style.display = 'none';
            saveProgress();
            updateCountdown();
            setInterval(updateCountdown, 60000);
        }, config.wordLength * 200 + 500);
        return false;
    }
    
    if (isUserAction) saveProgress();
    return false;
}

function saveProgress() {
    const progress = JSON.parse(localStorage.getItem('wordleProgress')) || {};
    if (!progress[config.wordLength]) progress[config.wordLength] = {};
    
    const attempts = [];
    for (let i = 0; i < config.currentAttempt; i++) {
        const row = board.children[i];
        let word = '';
        for (let j = 0; j < config.wordLength; j++) {
            word += row.children[j].textContent;
        }
        attempts.push(word);
    }
    
    progress[config.wordLength][config.gameMode] = {
        attempts: attempts,
        keyboardState: config.keyboardState,
        gameOver: config.gameOver
    };
    
    localStorage.setItem('wordleProgress', JSON.stringify(progress));
}

function showMessage(text, type) {
    message.textContent = text;
    message.className = `message show ${type}`;
}

function shareStats() {
    let shareText = `Sem Palavras - Estatísticas\n\n`;
    shareText += `Jogos: ${stats.gamesPlayed}\n`;
    shareText += `Vitórias: ${stats.gamesWon} (${stats.gamesPlayed > 0 ? Math.round((stats.gamesWon / stats.gamesPlayed) * 100) : 0}%)\n`;
    shareText += `Sequência atual: ${stats.currentStreak}\n`;
    shareText += `Máxima sequência: ${stats.maxStreak}\n\n`;
    shareText += `Distribuição de tentativas:\n`;
    
    for (let i = 0; i < 6; i++) {
        shareText += `${i + 1}: ${stats.guessDistribution[i]}\n`;
    }
    
    if (navigator.share) {
        navigator.share({
            title: 'Minhas Estatísticas - Sem Palavras',
            text: shareText
        }).catch(() => copyToClipboard(shareText));
    } else {
        copyToClipboard(shareText);
    }
}

function copyToClipboard(text) {
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    showMessage('Estatísticas copiadas!', 'success');
    setTimeout(() => message.className = 'message', 2000);
}

function forceReset() {
    const password = prompt("Digite a senha administrativa para resetar o jogo:");
    if (password === ADMIN_PASSWORD) {
        localStorage.removeItem('wordleDaily');
        localStorage.removeItem('wordleProgress');
        localStorage.removeItem('wordleStats');
        alert("Jogo resetado com sucesso! A página será recarregada.");
        location.reload();
    } else if (password) {
        alert("Senha incorreta!");
    }
}

async function safeInitGame() {
    try {
        await initGame();
    } catch (error) {
        console.error('Erro ao inicializar o jogo:', error);
        localStorage.removeItem('wordleProgress');
        await initGame();
    }
}

// Event listeners
document.addEventListener('keydown', (e) => {
    if (config.gameOver) return;
    if (e.key === 'Enter') checkGuess(true);
    else if (e.key === 'Backspace') removeLetter();
    else if (/^[A-Za-z]$/.test(e.key)) addLetter(e.key.toUpperCase());
});

keys.forEach(key => {
    key.addEventListener('click', () => {
        if (config.gameOver) return;
        const keyValue = key.dataset.key;
        if (keyValue === 'Enter') checkGuess(true);
        else if (keyValue === 'Backspace') removeLetter();
        else addLetter(keyValue);
    });
});

wordLengthSelect.addEventListener('change', () => {
    const newSize = parseInt(wordLengthSelect.value);
    const progress = JSON.parse(localStorage.getItem('wordleProgress')) || {};
    
    if (progress[newSize]?.[config.gameMode]?.gameOver) {
        showMessage(`Você já completou ${newSize} letras no modo ${config.gameMode === 'daily' ? 'temático' : 'aleatório'} hoje! Escolha outro tamanho.`, 'error');
        wordLengthSelect.value = config.wordLength;
        return;
    }
    
    config.wordLength = newSize;
    safeInitGame();
});

gameModeSelect.addEventListener('change', () => {
    const newMode = gameModeSelect.value;
    const progress = JSON.parse(localStorage.getItem('wordleProgress')) || {};
    
    if (progress[config.wordLength]?.[newMode]?.gameOver) {
        showMessage(`Você já completou o jogo de ${config.wordLength} letras no modo ${newMode === 'daily' ? 'temático' : 'aleatório'} hoje!`, 'error');
        gameModeSelect.value = config.gameMode;
        return;
    }
    
    config.gameMode = newMode;
    safeInitGame();
});

statsBtn.addEventListener('click', () => statsPanel.classList.add('show'));
closeStatsBtn.addEventListener('click', () => statsPanel.classList.remove('show'));
shareStatsBtn.addEventListener('click', shareStats);

// Verifica mudança de dia
setInterval(() => {
    if (isNewDay()) location.reload();
}, 60000);

// Inicia o jogo e estatísticas
initStats();
updateStatsDisplay();
safeInitGame();
    </script>
</body>
</html>
